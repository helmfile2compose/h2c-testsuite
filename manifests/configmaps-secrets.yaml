# ConfigMap used as env source
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: default
data:
  APP_ENV: production
  APP_DEBUG: "false"
  APP_URL: https://app.example.com
  LOG_FORMAT: json
---
# ConfigMap used as volume mount
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: default
data:
  nginx.conf: |
    server {
      listen 80;
      server_name _;
      location / {
        proxy_pass http://backend-service:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
      }
    }
  mime.types: |
    types {
      text/html  html;
      text/css   css;
      application/javascript js;
    }
---
# Secret used as env source
apiVersion: v1
kind: Secret
metadata:
  name: api-secrets
  namespace: default
type: Opaque
data:
  database-url: cG9zdGdyZXNxbDovL3VzZXI6cGFzc0Bwb3N0Z3Jlc3FsOjU0MzIvYXBpZGI=
  jwt-secret: c3VwZXItc2VjcmV0LWp3dC1rZXktMTIzNDU2
  api-key: YWJjZGVmMTIzNDU2Nzg5MA==
---
# Secret used as volume mount (TLS certs)
apiVersion: v1
kind: Secret
metadata:
  name: tls-secure-example
  namespace: default
type: kubernetes.io/tls
data:
  tls.crt: LS0tLS1CRUdJTi...
  tls.key: LS0tLS1CRUdJTi...
---
# Secret for PostgreSQL
apiVersion: v1
kind: Secret
metadata:
  name: postgresql-secret
  namespace: default
type: Opaque
data:
  postgres-password: cGFzc3dvcmQxMjM=
---
# ConfigMap with binary data
apiVersion: v1
kind: ConfigMap
metadata:
  name: binary-config
  namespace: default
binaryData:
  logo.png: iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==
data:
  description: "This configmap has both data and binaryData"
---
# Shared ConfigMap (referenced by multiple deployments)
apiVersion: v1
kind: ConfigMap
metadata:
  name: shared-settings
  namespace: default
data:
  CACHE_TTL: "300"
  FEATURE_FLAG_X: "true"
  CORS_ORIGINS: "https://app.example.com,https://admin.example.com"
---
# Deployment that uses envFrom (configmap + secret)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: config-consumer
  namespace: default
  labels:
    app: config-consumer
spec:
  replicas: 1
  selector:
    matchLabels:
      app: config-consumer
  template:
    metadata:
      labels:
        app: config-consumer
    spec:
      containers:
        - name: app
          image: myregistry/config-consumer:v1.0.0
          ports:
            - containerPort: 8080
          envFrom:
            - configMapRef:
                name: app-config
            - configMapRef:
                name: shared-settings
            - secretRef:
                name: api-secrets
          volumeMounts:
            - name: nginx-conf
              mountPath: /etc/nginx/conf.d
              readOnly: true
      volumes:
        - name: nginx-conf
          configMap:
            name: nginx-config
---
# Deployment that also references shared-settings (tests shared configmap)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: another-consumer
  namespace: default
  labels:
    app: another-consumer
spec:
  replicas: 1
  selector:
    matchLabels:
      app: another-consumer
  template:
    metadata:
      labels:
        app: another-consumer
    spec:
      containers:
        - name: app
          image: myregistry/another-consumer:v1.0.0
          ports:
            - containerPort: 3000
          envFrom:
            - configMapRef:
                name: shared-settings
          env:
            - name: SPECIFIC_VAR
              value: "only-for-this-service"
